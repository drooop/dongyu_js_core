{
  "version": "mt.v0",
  "op_id": "ui_to_matrix_forwarder_v0",
  "records": [
    {
      "op": "add_label",
      "model_id": -10,
      "p": 1,
      "r": 0,
      "c": 0,
      "k": "forward_ui_events",
      "t": "function",
      "v": "const mailbox = ctx.getLabel({ model_id: -1, p: 0, r: 0, c: 1, k: 'ui_event' });\nconsole.log('[forward_ui_events] mailbox value:', JSON.stringify(mailbox));\nif (mailbox) {\n  var payload = mailbox.payload || mailbox;\n  var action = payload.action || 'unknown';\n  var opId = (payload.meta && payload.meta.op_id) || ('ui_' + Date.now());\n  console.log('[forward_ui_events] Forwarding to Matrix:', action, 'op_id:', opId);\n  var p = ctx.sendMatrix({\n    version: 'v0',\n    type: 'ui_event',\n    op_id: opId,\n    action: action,\n    data: payload,\n    timestamp: Date.now()\n  });\n  if (p && typeof p.then === 'function') {\n    p.then(function() { console.log('[forward_ui_events] Matrix send OK'); })\n     .catch(function(err) { console.warn('[forward_ui_events] Matrix send failed (non-fatal):', err.message); });\n  }\n  // NOTE: Do NOT clear the mailbox here. The LocalBusAdapter.consumeOnce()\n  // needs to read and process the action locally (e.g. label_add/label_update).\n  // The adapter will clear the mailbox after processing.\n} else {\n  console.log('[forward_ui_events] No mailbox data, skipping');\n}"
    }
  ]
}
